(function(){"use strict";var t={2999:function(t,o,e){var n=e(9242),s=e(3396);const a={class:"container"},r=(0,s._)("h1",null,"Библиотека",-1),i=(0,s._)("li",null,[(0,s._)("a",{href:"#"},"Главная")],-1),l=(0,s._)("li",null,[(0,s._)("a",{href:"#"},"Каталог")],-1),u=(0,s._)("li",null,[(0,s._)("a",{href:"#"},"Контакты")],-1),c=(0,s._)("a",{href:"#"},"Выход",-1),h=[c];function d(t,o,e,c,d,p){const m=(0,s.up)("router-view"),f=(0,s.up)("modal");return(0,s.wg)(),(0,s.iD)(s.HY,null,[t.checkLogin?((0,s.wg)(),(0,s.iD)(s.HY,{key:0},[(0,s._)("nav",null,[(0,s._)("header",null,[(0,s._)("div",a,[r,(0,s._)("nav",null,[(0,s._)("ul",null,[i,l,u,(0,s._)("li",{onClick:o[0]||(o[0]=(0,n.iM)(((...o)=>t.logout&&t.logout(...o)),["prevent"]))},h)])])])])]),(0,s._)("main",null,[(0,s.Wm)(m)])],64)):(0,s.kq)("",!0),t.checkLogin?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(f,{key:1}))],64)}var p=e(65);const m={class:"modal"},f={class:"modal-content"},g=(0,s._)("h2",null,"Авторизация",-1),w={class:"input-group"},v=(0,s._)("label",{for:"username"},"Имя пользователя:",-1),k={class:"input-group"},_=(0,s._)("label",{for:"password"},"Пароль:",-1);function b(t,o,e,a,r,i){return(0,s.wg)(),(0,s.iD)("div",m,[(0,s._)("div",f,[g,(0,s._)("form",null,[(0,s._)("div",w,[v,(0,s.wy)((0,s._)("input",{"onUpdate:modelValue":o[0]||(o[0]=o=>t.username=o),type:"text",id:"username",name:"username"},null,512),[[n.nr,t.username]])]),(0,s._)("div",k,[_,(0,s.wy)((0,s._)("input",{"onUpdate:modelValue":o[1]||(o[1]=o=>t.password=o),type:"password",id:"password",name:"password"},null,512),[[n.nr,t.password]])]),(0,s._)("input",{onClick:o[2]||(o[2]=(0,n.iM)((o=>t.auth({username:t.username,password:t.password})),["prevent"])),type:"submit",value:"Войти"})])])])}var y={name:"ModalAuth",methods:{...(0,p.nv)(["auth"])},data:function(){return{username:"",password:""}}},S=e(89);const M=(0,S.Z)(y,[["render",b]]);var O=M,A={components:{Modal:O},computed:{...(0,p.Se)(["checkLogin"])},methods:{...(0,p.nv)(["logout"])}};const B=(0,S.Z)(A,[["render",d]]);var I=B,Z=e(2483);const D={class:"container"},P=(0,s._)("h2",null,"Список книг",-1),j={class:"book-list"};function L(t,o,e,n,a,r){const i=(0,s.up)("AppBook");return(0,s.wg)(),(0,s.iD)("section",null,[(0,s._)("div",D,[P,(0,s._)("ul",j,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(t.books,(t=>((0,s.wg)(),(0,s.j4)(i,{key:t.id,title:t.title,author:t.author,year:t.year},null,8,["title","author","year"])))),128))])])])}var $=e(7139);const x={href:"#"};function C(t,o,e,n,a,r){return(0,s.wg)(),(0,s.iD)("li",null,[(0,s._)("a",x,[(0,s._)("h3",null,(0,$.zw)(e.title),1),(0,s._)("p",null,(0,$.zw)(e.author),1),(0,s._)("p",null,(0,$.zw)(e.year),1)])])}var H={name:"AppBook",props:{title:String,author:String,year:String}};const T=(0,S.Z)(H,[["render",C]]);var z=T,R={name:"MainPage",components:{AppBook:z},computed:{...(0,p.Se)(["books"])}};const X=(0,S.Z)(R,[["render",L]]);var Y=X;const q=[{path:"/",name:"home",component:Y}],E=(0,Z.p7)({history:(0,Z.r5)(),routes:q});var F=E,U={namespaced:!0,state:{modals:{auth:{show:!1}}},getters:{getModalStatus:t=>o=>t.modals[o].show},actions:{chengeAuthModal({commit:t}){t("chengeModalShow","auth")},closeAllModals({commit:t}){t("closeAllModals")}},mutations:{chengeModalShow({modals:t},o){t[o].show=!t[o].show},closeAllModals({modals:t}){for(let o in t)t[o].show=!1}}},V=e(7327);class K{constructor(){(0,V.Z)(this,"_basePath","http://test-tasks.local/"),(0,V.Z)(this,"_baseApiPath","http://test-tasks.local/api"),(0,V.Z)(this,"getResource",(async t=>{const o=localStorage.getItem("sessionId"),e=new Headers;o&&e.append("X-Session-ID",o);const n=await fetch(`${this._baseApiPath}${t}`,{headers:e});if(!n.ok)return{status:n.status};const s=await n.json();return{status:n.status,result:s}})),(0,V.Z)(this,"getAllBooks",(async()=>{const t=await this.getResource("/books/");return t})),(0,V.Z)(this,"getBook",(async t=>{const o=await this.getResource(`/books/${t}`);return o})),(0,V.Z)(this,"auth",(async t=>{let o=new FormData;o.append("username",t.username),o.append("password",t.password);const e=await fetch(`${this._basePath}login`,{mode:"cors",method:"POST",body:o});if(!e.ok)throw new Error(`Could not fetch ${this._basePath}, received ${e.status}`);const n=e.headers.get("X-Session-ID");return localStorage.setItem("sessionId",n),e})),(0,V.Z)(this,"logOut",(async()=>{const t=localStorage.getItem("sessionId"),o=new Headers;t&&o.append("X-Session-ID",t);const e=await fetch(`${this._basePath}logout`,{headers:o});return e.ok&&localStorage.removeItem("sessionId"),e}))}}const W=new K;var G=(0,p.MT)({state:{apiSerice:W,books:[],login:!1},getters:{apiSerice:({apiSerice:t})=>t,checkLogin:({login:t})=>t,books:({books:t})=>t},mutations:{setBooks(t,o){t.books=o},setLogin(t,o){t.login=o}},actions:{async loadBooks(){const t=await this.state.apiSerice.getAllBooks();401===t.status?this.commit("setLogin",!1):(this.commit("setBooks",t.result),this.commit("setLogin",!0))},async auth({commit:t,dispatch:o},e){const n=await this.state.apiSerice.auth(e);console.log(n),n.ok&&this.dispatch("loadBooks")},async logout({commit:t}){const o=await this.state.apiSerice.logOut();o.ok&&t("setLogin",!1)}},modules:{modals:U},strict:!1});G.dispatch("loadBooks").then((()=>{(0,n.ri)(I).use(G).use(F).mount("#app")}))}},o={};function e(n){var s=o[n];if(void 0!==s)return s.exports;var a=o[n]={exports:{}};return t[n](a,a.exports,e),a.exports}e.m=t,function(){var t=[];e.O=function(o,n,s,a){if(!n){var r=1/0;for(c=0;c<t.length;c++){n=t[c][0],s=t[c][1],a=t[c][2];for(var i=!0,l=0;l<n.length;l++)(!1&a||r>=a)&&Object.keys(e.O).every((function(t){return e.O[t](n[l])}))?n.splice(l--,1):(i=!1,a<r&&(r=a));if(i){t.splice(c--,1);var u=s();void 0!==u&&(o=u)}}return o}a=a||0;for(var c=t.length;c>0&&t[c-1][2]>a;c--)t[c]=t[c-1];t[c]=[n,s,a]}}(),function(){e.n=function(t){var o=t&&t.__esModule?function(){return t["default"]}:function(){return t};return e.d(o,{a:o}),o}}(),function(){e.d=function(t,o){for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})}}(),function(){e.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){e.o=function(t,o){return Object.prototype.hasOwnProperty.call(t,o)}}(),function(){var t={143:0};e.O.j=function(o){return 0===t[o]};var o=function(o,n){var s,a,r=n[0],i=n[1],l=n[2],u=0;if(r.some((function(o){return 0!==t[o]}))){for(s in i)e.o(i,s)&&(e.m[s]=i[s]);if(l)var c=l(e)}for(o&&o(n);u<r.length;u++)a=r[u],e.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return e.O(c)},n=self["webpackChunkbooks"]=self["webpackChunkbooks"]||[];n.forEach(o.bind(null,0)),n.push=o.bind(null,n.push.bind(n))}();var n=e.O(void 0,[998],(function(){return e(2999)}));n=e.O(n)})();
//# sourceMappingURL=app.115cedc1.js.map