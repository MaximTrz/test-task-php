(function(){"use strict";var t={9612:function(t,o,e){var n=e(9242),r=e(3396);const s={class:"container"},a=(0,r._)("h1",null,"Библиотека",-1),i=(0,r._)("li",null,[(0,r._)("a",{href:"#"},"Главная")],-1),u=(0,r._)("li",null,[(0,r._)("a",{href:"#"},"Каталог")],-1),l=(0,r._)("li",null,[(0,r._)("a",{href:"#"},"Контакты")],-1),c=(0,r._)("a",{href:"#"},"Выход",-1),p=[c];function h(t,o,e,c,h,d){const g=(0,r.up)("router-view"),f=(0,r.up)("modal");return(0,r.wg)(),(0,r.iD)(r.HY,null,[t.checkLogin?((0,r.wg)(),(0,r.iD)(r.HY,{key:0},[(0,r._)("nav",null,[(0,r._)("header",null,[(0,r._)("div",s,[a,(0,r._)("nav",null,[(0,r._)("ul",null,[i,u,l,(0,r._)("li",{onClick:o[0]||(o[0]=(0,n.iM)(((...o)=>t.logout&&t.logout(...o)),["prevent"]))},p)])])])])]),(0,r._)("main",null,[(0,r.Wm)(g)])],64)):(0,r.kq)("",!0),t.checkLogin?(0,r.kq)("",!0):((0,r.wg)(),(0,r.j4)(f,{key:1}))],64)}var d=e(65);const g={class:"modal"},f={class:"modal-content"},m=(0,r._)("h2",null,"Авторизация",-1),k={class:"input-group"},w=(0,r._)("label",{for:"username"},"Имя пользователя:",-1),v={class:"input-group"},_=(0,r._)("label",{for:"password"},"Пароль:",-1),b={key:0,class:"login-error"};function y(t,o,e,s,a,i){return(0,r.wg)(),(0,r.iD)("div",g,[(0,r._)("div",f,[m,(0,r._)("form",null,[(0,r._)("div",k,[w,(0,r.wy)((0,r._)("input",{"onUpdate:modelValue":o[0]||(o[0]=o=>t.username=o),type:"text",id:"username",name:"username"},null,512),[[n.nr,t.username]])]),(0,r._)("div",v,[_,(0,r.wy)((0,r._)("input",{"onUpdate:modelValue":o[1]||(o[1]=o=>t.password=o),type:"password",id:"password",name:"password"},null,512),[[n.nr,t.password]])]),t.loginError?((0,r.wg)(),(0,r.iD)("p",b,"Неверный лолин или Пароль")):(0,r.kq)("",!0),(0,r._)("input",{onClick:o[2]||(o[2]=(0,n.iM)((o=>t.auth({username:t.username,password:t.password})),["prevent"])),type:"submit",value:"Войти"})])])])}var S={name:"ModalAuth",methods:{...(0,d.nv)(["auth"])},computed:{...(0,d.Se)(["loginError"])},data:function(){return{username:"",password:""}}},O=e(89);const B=(0,O.Z)(S,[["render",y]]);var D=B,I={components:{Modal:D},computed:{...(0,d.Se)(["checkLogin"])},methods:{...(0,d.nv)(["logout"])}};const L=(0,O.Z)(I,[["render",h]]);var Z=L,E=e(2483);const j={class:"container"},P=(0,r._)("h2",null,"Список книг",-1),A={class:"book-list"};function M(t,o,e,n,s,a){const i=(0,r.up)("AppBook");return(0,r.wg)(),(0,r.iD)("section",null,[(0,r._)("div",j,[P,(0,r._)("ul",A,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(t.books,(t=>((0,r.wg)(),(0,r.j4)(i,{key:t.id,title:t.title,author:t.author,year:t.year},null,8,["title","author","year"])))),128))])])])}var x=e(7139);const H={href:"#"};function $(t,o,e,n,s,a){return(0,r.wg)(),(0,r.iD)("li",null,[(0,r._)("a",H,[(0,r._)("h3",null,(0,x.zw)(e.title),1),(0,r._)("p",null,(0,x.zw)(e.author),1),(0,r._)("p",null,(0,x.zw)(e.year),1)])])}var C={name:"AppBook",props:{title:String,author:String,year:String}};const T=(0,O.Z)(C,[["render",$]]);var q=T,z={name:"MainPage",components:{AppBook:q},computed:{...(0,d.Se)(["books"])}};const R=(0,O.Z)(z,[["render",M]]);var X=R;const Y=[{path:"/",name:"home",component:X}],F=(0,E.p7)({history:(0,E.r5)(),routes:Y});var U=F,V=e(7327);class K{constructor(){(0,V.Z)(this,"_basePath","http://test-tasks.local/"),(0,V.Z)(this,"_baseApiPath","http://test-tasks.local/api"),(0,V.Z)(this,"getResource",(async t=>{const o=localStorage.getItem("sessionId"),e=new Headers;o&&e.append("X-Session-ID",o);const n=await fetch(`${this._baseApiPath}${t}`,{headers:e});if(!n.ok)return{status:n.status};const r=await n.json();return{status:n.status,result:r}})),(0,V.Z)(this,"getAllBooks",(async()=>{const t=await this.getResource("/books/");return t})),(0,V.Z)(this,"getBook",(async t=>{const o=await this.getResource(`/books/${t}`);return o})),(0,V.Z)(this,"auth",(async t=>{let o=new FormData;o.append("username",t.username),o.append("password",t.password);const e=await fetch(`${this._basePath}login`,{mode:"cors",method:"POST",body:o});if(!e.ok)return e;const n=e.headers.get("X-Session-ID");return localStorage.setItem("sessionId",n),e})),(0,V.Z)(this,"logOut",(async()=>{const t=localStorage.getItem("sessionId"),o=new Headers;t&&o.append("X-Session-ID",t);const e=await fetch(`${this._basePath}logout`,{headers:o});return e.ok&&localStorage.removeItem("sessionId"),e}))}}const W=new K;var G=(0,d.MT)({state:{apiSerice:W,books:[],login:!1,loginError:!1},getters:{apiSerice:({apiSerice:t})=>t,checkLogin:({login:t})=>t,books:({books:t})=>t,loginError:({loginError:t})=>t},mutations:{setBooks(t,o){t.books=o},setLogin(t,o){t.login=o},setLoginError(t,o){t.loginError=o}},actions:{async loadBooks(){const t=await this.state.apiSerice.getAllBooks();401===t.status?this.commit("setLogin",!1):(this.commit("setBooks",t.result),this.commit("setLogin",!0))},async auth({commit:t,dispatch:o},e){const n=await this.state.apiSerice.auth(e);console.log(n),n.ok?(this.dispatch("loadBooks"),t("setLoginError",!1)):t("setLoginError",!0)},async logout({commit:t}){const o=await this.state.apiSerice.logOut();o.ok&&t("setLogin",!1)}},modules:{},strict:!1});G.dispatch("loadBooks").then((()=>{(0,n.ri)(Z).use(G).use(U).mount("#app")}))}},o={};function e(n){var r=o[n];if(void 0!==r)return r.exports;var s=o[n]={exports:{}};return t[n](s,s.exports,e),s.exports}e.m=t,function(){var t=[];e.O=function(o,n,r,s){if(!n){var a=1/0;for(c=0;c<t.length;c++){n=t[c][0],r=t[c][1],s=t[c][2];for(var i=!0,u=0;u<n.length;u++)(!1&s||a>=s)&&Object.keys(e.O).every((function(t){return e.O[t](n[u])}))?n.splice(u--,1):(i=!1,s<a&&(a=s));if(i){t.splice(c--,1);var l=r();void 0!==l&&(o=l)}}return o}s=s||0;for(var c=t.length;c>0&&t[c-1][2]>s;c--)t[c]=t[c-1];t[c]=[n,r,s]}}(),function(){e.n=function(t){var o=t&&t.__esModule?function(){return t["default"]}:function(){return t};return e.d(o,{a:o}),o}}(),function(){e.d=function(t,o){for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})}}(),function(){e.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){e.o=function(t,o){return Object.prototype.hasOwnProperty.call(t,o)}}(),function(){var t={143:0};e.O.j=function(o){return 0===t[o]};var o=function(o,n){var r,s,a=n[0],i=n[1],u=n[2],l=0;if(a.some((function(o){return 0!==t[o]}))){for(r in i)e.o(i,r)&&(e.m[r]=i[r]);if(u)var c=u(e)}for(o&&o(n);l<a.length;l++)s=a[l],e.o(t,s)&&t[s]&&t[s][0](),t[s]=0;return e.O(c)},n=self["webpackChunkbooks"]=self["webpackChunkbooks"]||[];n.forEach(o.bind(null,0)),n.push=o.bind(null,n.push.bind(n))}();var n=e.O(void 0,[998],(function(){return e(9612)}));n=e.O(n)})();
//# sourceMappingURL=app.44282b1c.js.map